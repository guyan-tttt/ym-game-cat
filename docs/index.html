<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小猫收集家</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B35',
                        secondary: '#8BC34A',
                        background: '#E3F2FD',
                        'game-over': '#F44336',
                        'game-start': '#4CAF50'
                    },
                    fontFamily: {
                        sans: ['Arial', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            }
            .text-shadow-lg {
                text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.5);
            }
            .btn-3d {
                @apply relative px-8 py-4 rounded-xl font-bold transform transition-all duration-150 shadow-lg;
            }
            .btn-3d-primary {
                @apply bg-primary text-white shadow-[0_4px_0_0_#e05a2e] active:translate-y-1 active:shadow-[0_2px_0_0_#e05a2e] hover:brightness-105;
            }
            .btn-3d-secondary {
                @apply bg-secondary text-white shadow-[0_4px_0_0_#7cb342] active:translate-y-1 active:shadow-[0_2px_0_0_#7cb342] hover:brightness-105;
            }
            .game-container {
                @apply relative w-full max-w-3xl mx-auto overflow-hidden rounded-2xl shadow-2xl;
                height: calc(100vh - 4rem);
                max-height: 800px;
            }
            .cloud {
                @apply absolute bg-white rounded-full opacity-90;
            }
        }
    </style>
</head>
<body class="bg-background min-h-screen flex flex-col items-center justify-center p-4">
    <div class="text-center mb-4">
        <h1 class="text-4xl md:text-5xl font-bold text-primary text-shadow-lg">猫咪收集家</h1>
        <p class="text-gray-600 mt-2">控制小猫收集胡萝卜，避开纸巾！</p>
    </div>

    <div class="game-container bg-cover bg-center" id="gameContainer" style="background-image: url('https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/super_tool/b1806abbdd754d51ba5b5f8a62adfc04~tplv-a9rns2rl98-image.image?rcl=202512311349244589DCD73B4D15CE8F90&rk3s=8e244e95&rrcfp=f06b921b&x-expires=1769752176&x-signature=bcEYTccQEhI6ODb0fBRSIIUZZuQ%3D');">
        <!-- 开始界面 -->
        <div id="startScreen" class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 z-30">
            <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl text-center max-w-xs w-full">
                <img src="./assets/大猫咪.png" alt="小猫" class="w-20 h-32 mx-auto mb-4 animate-bounce-slow">
                <h2 class="text-2xl font-bold text-primary mb-2">准备开始！</h2>
                <p class="text-gray-600 mb-6">移动鼠标控制小猫左右移动，收集胡萝卜，避开纸巾！</p>
                <div class="flex flex-col gap-3">
                    <button id="startBtn" class="btn-3d btn-3d-primary">
                        <i class="fa fa-play mr-2"></i>开始游戏
                    </button>
                    <div class="text-sm text-gray-500">选择难度：</div>
                    <div class="flex justify-center gap-3">
                        <button data-difficulty="easy" class="difficulty-btn px-4 py-2 rounded-lg bg-green-100 text-green-800 font-medium hover:bg-green-200 active">简单</button>
                        <button data-difficulty="normal" class="difficulty-btn px-4 py-2 rounded-lg bg-yellow-100 text-yellow-800 font-medium hover:bg-yellow-200">普通</button>
                        <button data-difficulty="hard" class="difficulty-btn px-4 py-2 rounded-lg bg-red-100 text-red-800 font-medium hover:bg-red-200">困难</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div id="gameScreen" class="hidden">
            <canvas id="gameCanvas" class="w-full h-full"></canvas>
            <div class="absolute top-4 left-4 bg-white bg-opacity-70 rounded-lg px-4 py-2 shadow-md">
                <div class="text-lg font-bold text-primary">得分: <span id="scoreDisplay">0</span></div>
            </div>
            <div class="absolute top-4 right-4 bg-white bg-opacity-70 rounded-lg px-4 py-2 shadow-md flex items-center gap-2">
                <div class="text-lg font-bold text-red-500">生命:</div>
                <div id="livesDisplay" class="flex gap-1">
                    <i class="fa fa-heart text-red-500"></i>
                    <i class="fa fa-heart text-red-500"></i>
                    <i class="fa fa-heart text-red-500"></i>
                </div>
            </div>
        </div>

        <!-- 游戏结束界面 -->
        <div id="gameOverScreen" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-70 z-30">
            <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl text-center max-w-xs w-full">
                <h2 class="text-3xl font-bold text-game-over mb-2">游戏结束</h2>
                <p class="text-gray-600 mb-2">你的得分：</p>
                <p id="finalScore" class="text-4xl font-bold text-primary mb-6">0</p>
                <div class="flex flex-col gap-3">
                    <button id="restartBtn" class="btn-3d btn-3d-primary">
                        <i class="fa fa-refresh mr-2"></i>再来一次
                    </button>
                    <button id="backToStartBtn" class="btn-3d btn-3d-secondary">
                        <i class="fa fa-home mr-2"></i>返回主页
                    </button>
                </div>
            </div>
        </div>

        <!-- 暂停界面 -->
        <div id="pauseScreen" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-50 z-30">
            <div class="bg-white bg-opacity-90 p-8 rounded-2xl shadow-xl text-center">
                <h2 class="text-3xl font-bold text-primary mb-6">游戏暂停</h2>
                <div class="flex flex-col gap-3">
                    <button id="resumeBtn" class="btn-3d btn-3d-primary">
                        <i class="fa fa-play mr-2"></i>继续游戏
                    </button>
                    <button id="pauseRestartBtn" class="btn-3d btn-3d-secondary">
                        <i class="fa fa-refresh mr-2"></i>重新开始
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4 text-center text-sm text-gray-500">
        <p>使用鼠标左右移动控制小猫 | 按 ESC 键暂停游戏</p>
    </div>

    <script>
        // 游戏变量
        let canvas, ctx;
        let gameState = 'start'; // 'start', 'playing', 'paused', 'gameOver'
        let score = 0;
        let lives = 3;
        let difficulty = 'easy';
        let gameSpeed = 2;
        let spawnRate = 100;
        let spawnCounter = 0;
        
        // 游戏对象
        const cat = {
            x: 0,
            y: 0,
            width: 100,
            height: 170,
            speed: 5,
            image: new Image()
        };
        
        const items = [];
        const particles = [];
        
        // 图片资源
        cat.image.src = './assets/大猫咪.png';
        const carrotImage = new Image();
        carrotImage.src = './assets/萝卜.png';
        
        const tissueImage = new Image();
        tissueImage.src = './assets/纸巾.png';
        
        // 音效 - 使用audio元素
        const successSound = document.createElement('audio');
        successSound.src = './assets/蒸蚌.mp3';
        successSound.preload = 'auto';
        
        const failSound = document.createElement('audio');
        failSound.src = './assets/坤哔.mp3';
        failSound.preload = 'auto';
        
        function playSuccessSound() {
            try {
                successSound.currentTime = 0; // 重置播放位置
                successSound.play().catch(e => {
                    console.warn('成功音效播放失败，使用合成音效:', e);
                    playFallbackSuccessSound();
                });
            } catch (e) {
                console.warn('成功音效播放出错，使用合成音效:', e);
                playFallbackSuccessSound();
            }
        }
        
        function playFailSound() {
            try {
                failSound.currentTime = 0; // 重置播放位置
                failSound.play().catch(e => {
                    console.warn('失败音效播放失败，使用合成音效:', e);
                    playFallbackFailSound();
                });
            } catch (e) {
                console.warn('失败音效播放出错，使用合成音效:', e);
                playFallbackFailSound();
            }
        }
        
        function playFallbackSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 523; // C5
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
            
            setTimeout(() => {
                const oscillator2 = audioContext.createOscillator();
                const gainNode2 = audioContext.createGain();
                
                oscillator2.connect(gainNode2);
                gainNode2.connect(audioContext.destination);
                
                oscillator2.frequency.value = 659; // E5
                oscillator2.type = 'sine';
                
                gainNode2.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator2.start(audioContext.currentTime);
                oscillator2.stop(audioContext.currentTime + 0.1);
            }, 100);
            
            setTimeout(() => {
                const oscillator3 = audioContext.createOscillator();
                const gainNode3 = audioContext.createGain();
                
                oscillator3.connect(gainNode3);
                gainNode3.connect(audioContext.destination);
                
                oscillator3.frequency.value = 784; // G5
                oscillator3.type = 'sine';
                
                gainNode3.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode3.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                
                oscillator3.start(audioContext.currentTime);
                oscillator3.stop(audioContext.currentTime + 0.2);
            }, 200);
        }
        
        function playFallbackFailSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 200;
            oscillator.type = 'sawtooth';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }
        
        function playGameOverSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            playSound(audioContext, 330, 0.2);
            setTimeout(() => playSound(audioContext, 262, 0.2), 200);
            setTimeout(() => playSound(audioContext, 200, 0.4), 400);
        }
        
        function playSound(audioContext, frequency, duration) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        // 初始化游戏
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // 设置Canvas尺寸
            function resizeCanvas() {
                const container = document.getElementById('gameContainer');
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                // 重置小猫位置
                cat.x = canvas.width / 2 - cat.width / 2;
                cat.y = canvas.height - cat.height - 20;
            }
            
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // 鼠标移动控制
            canvas.addEventListener('mousemove', (e) => {
                if (gameState === 'playing') {
                    const rect = canvas.getBoundingClientRect();
                    cat.x = e.clientX - rect.left - cat.width / 2;
                    
                    // 限制小猫在画布内
                    cat.x = Math.max(0, Math.min(canvas.width - cat.width, cat.x));
                }
            });
            
            // 触摸控制
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (gameState === 'playing') {
                    const rect = canvas.getBoundingClientRect();
                    const touch = e.touches[0];
                    cat.x = touch.clientX - rect.left - cat.width / 2;
                    
                    // 限制小猫在画布内
                    cat.x = Math.max(0, Math.min(canvas.width - cat.width, cat.x));
                }
            }, { passive: false });
            
            // ESC键暂停
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (gameState === 'playing') {
                        pauseGame();
                    } else if (gameState === 'paused') {
                        resumeGame();
                    }
                }
            });
            
            // 难度选择
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active', 'bg-primary', 'text-white'));
                    btn.classList.add('active', 'bg-primary', 'text-white');
                    difficulty = btn.dataset.difficulty;
                    
                    // 设置难度参数
                    switch (difficulty) {
                        case 'easy':
                            gameSpeed = 2;
                            spawnRate = 100;
                            break;
                        case 'normal':
                            gameSpeed = 3;
                            spawnRate = 80;
                            break;
                        case 'hard':
                            gameSpeed = 4;
                            spawnRate = 60;
                            break;
                    }
                });
            });
            
            // 按钮事件
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('backToStartBtn').addEventListener('click', backToStart);
            document.getElementById('resumeBtn').addEventListener('click', resumeGame);
            document.getElementById('pauseRestartBtn').addEventListener('click', restartGame);
            
            // 创建云朵背景
            createClouds();
            
            // 开始游戏循环
            gameLoop();
        }
        
        // 创建云朵
        function createClouds() {
            const cloudContainer = document.getElementById('gameContainer');
            cloudContainer.querySelectorAll('.cloud').forEach(cloud => cloud.remove());
            
            for (let i = 0; i < 6; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                
                const size = Math.random() * 100 + 50;
                cloud.style.width = `${size}px`;
                cloud.style.height = `${size / 2}px`;
                cloud.style.left = `${Math.random() * 100}%`;
                cloud.style.top = `${Math.random() * 50}%`;
                cloud.style.animation = `float ${Math.random() * 20 + 10}s linear infinite`;
                
                cloudContainer.appendChild(cloud);
            }
        }
        
        // 开始游戏
        function startGame() {
            gameState = 'playing';
            score = 0;
            lives = 3;
            items.length = 0;
            particles.length = 0;
            spawnCounter = 0;
            
            updateUI();
            
            // 显示游戏界面
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('pauseScreen').classList.add('hidden');
            
            // 解锁音频上下文
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            // 预加载音效
            successSound.load();
            failSound.load();
        }
        
        // 暂停游戏
        function pauseGame() {
            gameState = 'paused';
            document.getElementById('pauseScreen').classList.remove('hidden');
        }
        
        // 继续游戏
        function resumeGame() {
            gameState = 'playing';
            document.getElementById('pauseScreen').classList.add('hidden');
        }
        
        // 重新开始游戏
        function restartGame() {
            document.getElementById('pauseScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            startGame();
        }
        
        // 返回开始界面
        function backToStart() {
            gameState = 'start';
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
        }
        
        // 游戏结束
        function gameOver() {
            gameState = 'gameOver';
            document.getElementById('finalScore').textContent = score;
            document.getElementById('gameOverScreen').classList.remove('hidden');
            playGameOverSound();
        }
        
        // 更新UI
        function updateUI() {
            document.getElementById('scoreDisplay').textContent = score;
            
            const livesDisplay = document.getElementById('livesDisplay');
            livesDisplay.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                livesDisplay.innerHTML += '<i class="fa fa-heart text-red-500"></i>';
            }
        }
        
        // 生成道具
        function spawnItem() {
            const item = {
                x: Math.random() * (canvas.width - 50),
                y: -50,
                width: 50,
                height: 50,
                type: Math.random() > 0.3 ? 'carrot' : 'tissue', // 70% 胡萝卜，30% 纸巾
                speed: gameSpeed + Math.random() * 2
            };
            
            items.push(item);
        }
        
        // 创建粒子效果
        function createParticles(x, y, color) {
            for (let i = 0; i < 8; i++) {
                const particle = {
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 30,
                    maxLife: 30,
                    color: color
                };
                particles.push(particle);
            }
        }
        
        // 检测碰撞
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        // 更新游戏状态
        function update() {
            if (gameState !== 'playing') return;
            
            // 生成道具
            spawnCounter++;
            if (spawnCounter >= spawnRate) {
                spawnItem();
                spawnCounter = 0;
            }
            
            // 更新道具位置
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.y += item.speed;
                
                // 检测碰撞
                if (checkCollision(cat, item)) {
            if (item.type === 'carrot') {
                        score += 10;
            playSuccessSound();
                        createParticles(item.x + item.width / 2, item.y + item.height / 2, '#FF6B35');
                        
                        // 显示"真棒"文字
                        showFloatingText(item.x, item.y, '蒸蚌！', '#4CAF50');
                    } else {
                        lives--;
                        playFailSound();
                        createParticles(item.x + item.width / 2, item.y + item.height / 2, '#F44336');
                        
                        // 显示"哎呀"文字
                        showFloatingText(item.x, item.y, '鸡哔！', '#F44336');
                        
                        if (lives <= 0) {
                            gameOver();
                            return;
                        }
                    }
                    
                    items.splice(i, 1);
                    updateUI();
                }
                
                // 移除超出屏幕的道具
                else if (item.y > canvas.height) {
                    items.splice(i, 1);
                }
            }
            
            // 更新粒子
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            // 更新浮动文字
            updateFloatingTexts();
            
            // 随着分数增加提高难度
            if (score > 0 && score % 100 === 0) {
                gameSpeed = Math.min(gameSpeed + 0.2, 6);
                spawnRate = Math.max(spawnRate - 5, 30);
            }
        }
        
        // 浮动文字系统
        const floatingTexts = [];
        
        function showFloatingText(x, y, text, color) {
            floatingTexts.push({
                x: x,
                y: y,
                text: text,
                color: color,
                life: 30,
                maxLife: 30,
                vx: (Math.random() - 0.5) * 2,
                vy: -2
            });
        }
        
        function updateFloatingTexts() {
            for (let i = floatingTexts.length - 1; i >= 0; i--) {
                const text = floatingTexts[i];
                text.x += text.vx;
                text.y += text.vy;
                text.life--;
                
                if (text.life <= 0) {
                    floatingTexts.splice(i, 1);
                }
            }
        }
        
        // 绘制游戏
        function draw() {
            if (!ctx) return;
            
            // 清空画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 绘制小猫
            ctx.drawImage(cat.image, cat.x, cat.y, cat.width, cat.height);
            
            // 绘制道具
            items.forEach(item => {
                if (item.type === 'carrot') {
                    ctx.drawImage(carrotImage, item.x, item.y, item.width, item.height);
                } else {
                    ctx.drawImage(tissueImage, item.x, item.y, item.width, item.height);
                }
            });
            
            // 绘制粒子
            particles.forEach(particle => {
                const alpha = particle.life / particle.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // 绘制浮动文字
            floatingTexts.forEach(text => {
                const alpha = text.life / text.maxLife;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = text.color;
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(text.text, text.x, text.y);
            });
            ctx.globalAlpha = 1;
        }
        
        // 游戏循环
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // 添加云朵浮动动画
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0% { transform: translateX(-100px); }
                100% { transform: translateX(calc(100vw + 100px)); }
            }
        `;
        document.head.appendChild(style);
        
        // 页面加载完成后初始化游戏
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
